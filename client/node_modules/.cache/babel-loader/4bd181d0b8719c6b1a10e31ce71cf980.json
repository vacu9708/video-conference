{"ast":null,"code":"/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\nvar _getusermedia = require('./getusermedia');\nObject.defineProperty(exports, 'shimGetUserMedia', {\n  enumerable: true,\n  get: function get() {\n    return _getusermedia.shimGetUserMedia;\n  }\n});\nvar _getdisplaymedia = require('./getdisplaymedia');\nObject.defineProperty(exports, 'shimGetDisplayMedia', {\n  enumerable: true,\n  get: function get() {\n    return _getdisplaymedia.shimGetDisplayMedia;\n  }\n});\nexports.shimMediaStream = shimMediaStream;\nexports.shimOnTrack = shimOnTrack;\nexports.shimGetSendersWithDtmf = shimGetSendersWithDtmf;\nexports.shimGetStats = shimGetStats;\nexports.shimSenderReceiverGetStats = shimSenderReceiverGetStats;\nexports.shimAddTrackRemoveTrackWithNative = shimAddTrackRemoveTrackWithNative;\nexports.shimAddTrackRemoveTrack = shimAddTrackRemoveTrack;\nexports.shimPeerConnection = shimPeerConnection;\nexports.fixNegotiationNeeded = fixNegotiationNeeded;\nvar _utils = require('../utils.js');\nvar utils = _interopRequireWildcard(_utils);\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n    newObj.default = obj;\n    return newObj;\n  }\n}\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nfunction shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\nfunction shimOnTrack(window) {\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && !('ontrack' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get: function get() {\n        return this._ontrack;\n      },\n      set: function set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    var origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {\n      var _this = this;\n      if (!this._ontrackpoly) {\n        this._ontrackpoly = function (e) {\n          // onaddstream does not fire when a track is added to an existing\n          // stream. But stream.onaddtrack is implemented so we use that.\n          e.stream.addEventListener('addtrack', function (te) {\n            var receiver = void 0;\n            if (window.RTCPeerConnection.prototype.getReceivers) {\n              receiver = _this.getReceivers().find(function (r) {\n                return r.track && r.track.id === te.track.id;\n              });\n            } else {\n              receiver = {\n                track: te.track\n              };\n            }\n            var event = new Event('track');\n            event.track = te.track;\n            event.receiver = receiver;\n            event.transceiver = {\n              receiver: receiver\n            };\n            event.streams = [e.stream];\n            _this.dispatchEvent(event);\n          });\n          e.stream.getTracks().forEach(function (track) {\n            var receiver = void 0;\n            if (window.RTCPeerConnection.prototype.getReceivers) {\n              receiver = _this.getReceivers().find(function (r) {\n                return r.track && r.track.id === track.id;\n              });\n            } else {\n              receiver = {\n                track: track\n              };\n            }\n            var event = new Event('track');\n            event.track = track;\n            event.receiver = receiver;\n            event.transceiver = {\n              receiver: receiver\n            };\n            event.streams = [e.stream];\n            _this.dispatchEvent(event);\n          });\n        };\n        this.addEventListener('addstream', this._ontrackpoly);\n      }\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', function (e) {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver', {\n          value: {\n            receiver: e.receiver\n          }\n        });\n      }\n      return e;\n    });\n  }\n}\nfunction shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && !('getSenders' in window.RTCPeerConnection.prototype) && 'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    var shimSenderWithDtmf = function shimSenderWithDtmf(pc, track) {\n      return {\n        track: track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n\n      var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\n        var sender = origAddTrack.apply(this, arguments);\n        if (!sender) {\n          sender = shimSenderWithDtmf(this, track);\n          this._senders.push(sender);\n        }\n        return sender;\n      };\n      var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\n        origRemoveTrack.apply(this, arguments);\n        var idx = this._senders.indexOf(sender);\n        if (idx !== -1) {\n          this._senders.splice(idx, 1);\n        }\n      };\n    }\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      var _this2 = this;\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(function (track) {\n        _this2._senders.push(shimSenderWithDtmf(_this2, track));\n      });\n    };\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\n      var _this3 = this;\n      this._senders = this._senders || [];\n      origRemoveStream.apply(this, [stream]);\n      stream.getTracks().forEach(function (track) {\n        var sender = _this3._senders.find(function (s) {\n          return s.track === track;\n        });\n        if (sender) {\n          // remove sender\n          _this3._senders.splice(_this3._senders.indexOf(sender), 1);\n        }\n      });\n    };\n  } else if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && 'getSenders' in window.RTCPeerConnection.prototype && 'createDTMFSender' in window.RTCPeerConnection.prototype && window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n    var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      var _this4 = this;\n      var senders = origGetSenders.apply(this, []);\n      senders.forEach(function (sender) {\n        return sender._pc = _this4;\n      });\n      return senders;\n    };\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get: function get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\nfunction shimGetStats(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  var origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    var _this5 = this;\n    var _arguments = Array.prototype.slice.call(arguments),\n      selector = _arguments[0],\n      onSucc = _arguments[1],\n      onErr = _arguments[2];\n\n    // If selector is a function then we are in the old style stats so just\n    // pass back the original getStats format to avoid breaking old users.\n\n    if (arguments.length > 0 && typeof selector === 'function') {\n      return origGetStats.apply(this, arguments);\n    }\n\n    // When spec-style getStats is supported, return those when called with\n    // either no arguments or the selector argument is null.\n    if (origGetStats.length === 0 && (arguments.length === 0 || typeof selector !== 'function')) {\n      return origGetStats.apply(this, []);\n    }\n    var fixChromeStats_ = function fixChromeStats_(response) {\n      var standardReport = {};\n      var reports = response.result();\n      reports.forEach(function (report) {\n        var standardStats = {\n          id: report.id,\n          timestamp: report.timestamp,\n          type: {\n            localcandidate: 'local-candidate',\n            remotecandidate: 'remote-candidate'\n          }[report.type] || report.type\n        };\n        report.names().forEach(function (name) {\n          standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n      });\n      return standardReport;\n    };\n\n    // shim getStats with maplike support\n    var makeMapStats = function makeMapStats(stats) {\n      return new Map(Object.keys(stats).map(function (key) {\n        return [key, stats[key]];\n      }));\n    };\n    if (arguments.length >= 2) {\n      var successCallbackWrapper_ = function successCallbackWrapper_(response) {\n        onSucc(makeMapStats(fixChromeStats_(response)));\n      };\n      return origGetStats.apply(this, [successCallbackWrapper_, selector]);\n    }\n\n    // promise-support\n    return new Promise(function (resolve, reject) {\n      origGetStats.apply(_this5, [function (response) {\n        resolve(makeMapStats(fixChromeStats_(response)));\n      }, reject]);\n    }).then(onSucc, onErr);\n  };\n}\nfunction shimSenderReceiverGetStats(window) {\n  if (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        var _this6 = this;\n        var senders = origGetSenders.apply(this, []);\n        senders.forEach(function (sender) {\n          return sender._pc = _this6;\n        });\n        return senders;\n      };\n    }\n    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        var sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      var sender = this;\n      return this._pc.getStats().then(function (result) {\n        return (\n          /* Note: this will include stats of all senders that\n           *   send a track with the same id as sender.track as\n           *   it is not possible to identify the RTCRtpSender.\n           */\n          utils.filterStats(result, sender.track, true)\n        );\n      });\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    var origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n        var _this7 = this;\n        var receivers = origGetReceivers.apply(this, []);\n        receivers.forEach(function (receiver) {\n          return receiver._pc = _this7;\n        });\n        return receivers;\n      };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', function (e) {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      var receiver = this;\n      return this._pc.getStats().then(function (result) {\n        return utils.filterStats(result, receiver.track, false);\n      });\n    };\n  }\n  if (!('getStats' in window.RTCRtpSender.prototype && 'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  var origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 && arguments[0] instanceof window.MediaStreamTrack) {\n      var track = arguments[0];\n      var sender = void 0;\n      var receiver = void 0;\n      var err = void 0;\n      this.getSenders().forEach(function (s) {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(function (r) {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || sender && receiver) {\n        return Promise.reject(new DOMException('There are more than one sender or receiver for the track.', 'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException('There is no sender or receiver for the track.', 'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\nfunction shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\n    var _this8 = this;\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n    return Object.keys(this._shimmedLocalStreams).map(function (streamId) {\n      return _this8._shimmedLocalStreams[streamId][0];\n    });\n  };\n  var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\n    if (!stream) {\n      return origAddTrack.apply(this, arguments);\n    }\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n    var sender = origAddTrack.apply(this, arguments);\n    if (!this._shimmedLocalStreams[stream.id]) {\n      this._shimmedLocalStreams[stream.id] = [stream, sender];\n    } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n      this._shimmedLocalStreams[stream.id].push(sender);\n    }\n    return sender;\n  };\n  var origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    var _this9 = this;\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n    stream.getTracks().forEach(function (track) {\n      var alreadyExists = _this9.getSenders().find(function (s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.', 'InvalidAccessError');\n      }\n    });\n    var existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    var newSenders = this.getSenders().filter(function (newSender) {\n      return existingSenders.indexOf(newSender) === -1;\n    });\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n  var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n    delete this._shimmedLocalStreams[stream.id];\n    return origRemoveStream.apply(this, arguments);\n  };\n  var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\n    var _this10 = this;\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n    if (sender) {\n      Object.keys(this._shimmedLocalStreams).forEach(function (streamId) {\n        var idx = _this10._shimmedLocalStreams[streamId].indexOf(sender);\n        if (idx !== -1) {\n          _this10._shimmedLocalStreams[streamId].splice(idx, 1);\n        }\n        if (_this10._shimmedLocalStreams[streamId].length === 1) {\n          delete _this10._shimmedLocalStreams[streamId];\n        }\n      });\n    }\n    return origRemoveTrack.apply(this, arguments);\n  };\n}\nfunction shimAddTrackRemoveTrack(window, browserDetails) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack && browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  var origGetLocalStreams = window.RTCPeerConnection.prototype.getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\n    var _this11 = this;\n    var nativeStreams = origGetLocalStreams.apply(this);\n    this._reverseStreams = this._reverseStreams || {};\n    return nativeStreams.map(function (stream) {\n      return _this11._reverseStreams[stream.id];\n    });\n  };\n  var origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    var _this12 = this;\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n    stream.getTracks().forEach(function (track) {\n      var alreadyExists = _this12.getSenders().find(function (s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.', 'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      var newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n  var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n    origRemoveStream.apply(this, [this._streams[stream.id] || stream]);\n    delete this._reverseStreams[this._streams[stream.id] ? this._streams[stream.id].id : stream.id];\n    delete this._streams[stream.id];\n  };\n  window.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\n    var _this13 = this;\n    if (this.signalingState === 'closed') {\n      throw new DOMException('The RTCPeerConnection\\'s signalingState is \\'closed\\'.', 'InvalidStateError');\n    }\n    var streams = [].slice.call(arguments, 1);\n    if (streams.length !== 1 || !streams[0].getTracks().find(function (t) {\n      return t === track;\n    })) {\n      // this is not fully correct but all we can manage without\n      // [[associated MediaStreams]] internal slot.\n      throw new DOMException('The adapter.js addTrack polyfill only supports a single ' + ' stream which is associated with the specified track.', 'NotSupportedError');\n    }\n    var alreadyExists = this.getSenders().find(function (s) {\n      return s.track === track;\n    });\n    if (alreadyExists) {\n      throw new DOMException('Track already exists.', 'InvalidAccessError');\n    }\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n    var oldStream = this._streams[stream.id];\n    if (oldStream) {\n      // this is using odd Chrome behaviour, use with caution:\n      // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n      // Note: we rely on the high-level addTrack/dtmf shim to\n      // create the sender with a dtmf sender.\n      oldStream.addTrack(track);\n\n      // Trigger ONN async.\n      Promise.resolve().then(function () {\n        _this13.dispatchEvent(new Event('negotiationneeded'));\n      });\n    } else {\n      var newStream = new window.MediaStream([track]);\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      this.addStream(newStream);\n    }\n    return this.getSenders().find(function (s) {\n      return s.track === track;\n    });\n  };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    var sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(function (internalId) {\n      var externalStream = pc._reverseStreams[internalId];\n      var internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'), externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp: sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    var sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(function (internalId) {\n      var externalStream = pc._reverseStreams[internalId];\n      var internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'), internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp: sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function (method) {\n    var nativeMethod = window.RTCPeerConnection.prototype[method];\n    var methodObj = _defineProperty({}, method, function () {\n      var _this14 = this;\n      var args = arguments;\n      var isLegacyCall = arguments.length && typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [function (description) {\n          var desc = replaceInternalStreamId(_this14, description);\n          args[0].apply(null, [desc]);\n        }, function (err) {\n          if (args[1]) {\n            args[1].apply(null, err);\n          }\n        }, arguments[2]]);\n      }\n      return nativeMethod.apply(this, arguments).then(function (description) {\n        return replaceInternalStreamId(_this14, description);\n      });\n    });\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n  var origSetLocalDescription = window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription = function setLocalDescription() {\n    if (!arguments.length || !arguments[0].type) {\n      return origSetLocalDescription.apply(this, arguments);\n    }\n    arguments[0] = replaceExternalStreamId(this, arguments[0]);\n    return origSetLocalDescription.apply(this, arguments);\n  };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  var origLocalDescription = Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype, 'localDescription', {\n    get: function get() {\n      var description = origLocalDescription.get.apply(this);\n      if (description.type === '') {\n        return description;\n      }\n      return replaceInternalStreamId(this, description);\n    }\n  });\n  window.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\n    var _this15 = this;\n    if (this.signalingState === 'closed') {\n      throw new DOMException('The RTCPeerConnection\\'s signalingState is \\'closed\\'.', 'InvalidStateError');\n    }\n    // We can not yet check for sender instanceof RTCRtpSender\n    // since we shim RTPSender. So we check if sender._pc is set.\n    if (!sender._pc) {\n      throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' + 'does not implement interface RTCRtpSender.', 'TypeError');\n    }\n    var isLocal = sender._pc === this;\n    if (!isLocal) {\n      throw new DOMException('Sender was not created by this connection.', 'InvalidAccessError');\n    }\n\n    // Search for the native stream the senders track belongs to.\n    this._streams = this._streams || {};\n    var stream = void 0;\n    Object.keys(this._streams).forEach(function (streamid) {\n      var hasTrack = _this15._streams[streamid].getTracks().find(function (track) {\n        return sender.track === track;\n      });\n      if (hasTrack) {\n        stream = _this15._streams[streamid];\n      }\n    });\n    if (stream) {\n      if (stream.getTracks().length === 1) {\n        // if this is the last track of the stream, remove the stream. This\n        // takes care of any shimmed _senders.\n        this.removeStream(this._reverseStreams[stream.id]);\n      } else {\n        // relying on the same odd chrome behaviour as above.\n        stream.removeTrack(sender.track);\n      }\n      this.dispatchEvent(new Event('negotiationneeded'));\n    }\n  };\n}\nfunction shimPeerConnection(window, browserDetails) {\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach(function (method) {\n      var nativeMethod = window.RTCPeerConnection.prototype[method];\n      var methodObj = _defineProperty({}, method, function () {\n        arguments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);\n        return nativeMethod.apply(this, arguments);\n      });\n      window.RTCPeerConnection.prototype[method] = methodObj[method];\n    });\n  }\n}\n\n// Attempt to fix ONN in plan-b mode.\nfunction fixNegotiationNeeded(window, browserDetails) {\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', function (e) {\n    var pc = e.target;\n    if (browserDetails.version < 72 || pc.getConfiguration && pc.getConfiguration().sdpSemantics === 'plan-b') {\n      if (pc.signalingState !== 'stable') {\n        return;\n      }\n    }\n    return e;\n  });\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","shimGetDisplayMedia","shimGetUserMedia","undefined","_typeof","Symbol","iterator","obj","constructor","prototype","_getusermedia","require","enumerable","get","_getdisplaymedia","shimMediaStream","shimOnTrack","shimGetSendersWithDtmf","shimGetStats","shimSenderReceiverGetStats","shimAddTrackRemoveTrackWithNative","shimAddTrackRemoveTrack","shimPeerConnection","fixNegotiationNeeded","_utils","utils","_interopRequireWildcard","__esModule","newObj","key","hasOwnProperty","call","default","_defineProperty","configurable","writable","window","MediaStream","webkitMediaStream","RTCPeerConnection","_ontrack","set","f","removeEventListener","addEventListener","origSetRemoteDescription","setRemoteDescription","_this","_ontrackpoly","e","stream","te","receiver","getReceivers","find","r","track","id","event","Event","transceiver","streams","dispatchEvent","getTracks","forEach","apply","arguments","wrapPeerConnectionEvent","shimSenderWithDtmf","pc","dtmf","_dtmf","kind","createDTMFSender","_pc","getSenders","_senders","slice","origAddTrack","addTrack","sender","push","origRemoveTrack","removeTrack","idx","indexOf","splice","origAddStream","addStream","_this2","origRemoveStream","removeStream","_this3","s","RTCRtpSender","origGetSenders","_this4","senders","origGetStats","getStats","_this5","_arguments","Array","selector","onSucc","onErr","length","fixChromeStats_","response","standardReport","reports","result","report","standardStats","timestamp","type","localcandidate","remotecandidate","names","name","stat","makeMapStats","stats","Map","keys","map","successCallbackWrapper_","Promise","resolve","reject","then","RTCRtpReceiver","_this6","filterStats","origGetReceivers","_this7","receivers","srcElement","MediaStreamTrack","err","DOMException","getLocalStreams","_this8","_shimmedLocalStreams","streamId","_this9","alreadyExists","existingSenders","newSenders","filter","newSender","concat","_this10","browserDetails","version","origGetLocalStreams","_this11","nativeStreams","_reverseStreams","_this12","_streams","newStream","_this13","signalingState","t","oldStream","replaceInternalStreamId","description","sdp","internalId","externalStream","internalStream","replace","RegExp","RTCSessionDescription","replaceExternalStreamId","method","nativeMethod","methodObj","_this14","args","isLegacyCall","desc","origSetLocalDescription","setLocalDescription","origLocalDescription","getOwnPropertyDescriptor","_this15","isLocal","streamid","hasTrack","webkitRTCPeerConnection","RTCIceCandidate","target","getConfiguration","sdpSemantics"],"sources":["G:/Software/github/video-conference/client/node_modules/webrtc-adapter/dist/chrome/chrome_shim.js"],"sourcesContent":["/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _getusermedia = require('./getusermedia');\n\nObject.defineProperty(exports, 'shimGetUserMedia', {\n  enumerable: true,\n  get: function get() {\n    return _getusermedia.shimGetUserMedia;\n  }\n});\n\nvar _getdisplaymedia = require('./getdisplaymedia');\n\nObject.defineProperty(exports, 'shimGetDisplayMedia', {\n  enumerable: true,\n  get: function get() {\n    return _getdisplaymedia.shimGetDisplayMedia;\n  }\n});\nexports.shimMediaStream = shimMediaStream;\nexports.shimOnTrack = shimOnTrack;\nexports.shimGetSendersWithDtmf = shimGetSendersWithDtmf;\nexports.shimGetStats = shimGetStats;\nexports.shimSenderReceiverGetStats = shimSenderReceiverGetStats;\nexports.shimAddTrackRemoveTrackWithNative = shimAddTrackRemoveTrackWithNative;\nexports.shimAddTrackRemoveTrack = shimAddTrackRemoveTrack;\nexports.shimPeerConnection = shimPeerConnection;\nexports.fixNegotiationNeeded = fixNegotiationNeeded;\n\nvar _utils = require('../utils.js');\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nfunction shimOnTrack(window) {\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && !('ontrack' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get: function get() {\n        return this._ontrack;\n      },\n      set: function set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n\n      enumerable: true,\n      configurable: true\n    });\n    var origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {\n      var _this = this;\n\n      if (!this._ontrackpoly) {\n        this._ontrackpoly = function (e) {\n          // onaddstream does not fire when a track is added to an existing\n          // stream. But stream.onaddtrack is implemented so we use that.\n          e.stream.addEventListener('addtrack', function (te) {\n            var receiver = void 0;\n            if (window.RTCPeerConnection.prototype.getReceivers) {\n              receiver = _this.getReceivers().find(function (r) {\n                return r.track && r.track.id === te.track.id;\n              });\n            } else {\n              receiver = { track: te.track };\n            }\n\n            var event = new Event('track');\n            event.track = te.track;\n            event.receiver = receiver;\n            event.transceiver = { receiver: receiver };\n            event.streams = [e.stream];\n            _this.dispatchEvent(event);\n          });\n          e.stream.getTracks().forEach(function (track) {\n            var receiver = void 0;\n            if (window.RTCPeerConnection.prototype.getReceivers) {\n              receiver = _this.getReceivers().find(function (r) {\n                return r.track && r.track.id === track.id;\n              });\n            } else {\n              receiver = { track: track };\n            }\n            var event = new Event('track');\n            event.track = track;\n            event.receiver = receiver;\n            event.transceiver = { receiver: receiver };\n            event.streams = [e.stream];\n            _this.dispatchEvent(event);\n          });\n        };\n        this.addEventListener('addstream', this._ontrackpoly);\n      }\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', function (e) {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver', { value: { receiver: e.receiver } });\n      }\n      return e;\n    });\n  }\n}\n\nfunction shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && !('getSenders' in window.RTCPeerConnection.prototype) && 'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    var shimSenderWithDtmf = function shimSenderWithDtmf(pc, track) {\n      return {\n        track: track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\n        var sender = origAddTrack.apply(this, arguments);\n        if (!sender) {\n          sender = shimSenderWithDtmf(this, track);\n          this._senders.push(sender);\n        }\n        return sender;\n      };\n\n      var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\n        origRemoveTrack.apply(this, arguments);\n        var idx = this._senders.indexOf(sender);\n        if (idx !== -1) {\n          this._senders.splice(idx, 1);\n        }\n      };\n    }\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      var _this2 = this;\n\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(function (track) {\n        _this2._senders.push(shimSenderWithDtmf(_this2, track));\n      });\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\n      var _this3 = this;\n\n      this._senders = this._senders || [];\n      origRemoveStream.apply(this, [stream]);\n\n      stream.getTracks().forEach(function (track) {\n        var sender = _this3._senders.find(function (s) {\n          return s.track === track;\n        });\n        if (sender) {\n          // remove sender\n          _this3._senders.splice(_this3._senders.indexOf(sender), 1);\n        }\n      });\n    };\n  } else if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && 'getSenders' in window.RTCPeerConnection.prototype && 'createDTMFSender' in window.RTCPeerConnection.prototype && window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n    var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      var _this4 = this;\n\n      var senders = origGetSenders.apply(this, []);\n      senders.forEach(function (sender) {\n        return sender._pc = _this4;\n      });\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get: function get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nfunction shimGetStats(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  var origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    var _this5 = this;\n\n    var _arguments = Array.prototype.slice.call(arguments),\n        selector = _arguments[0],\n        onSucc = _arguments[1],\n        onErr = _arguments[2];\n\n    // If selector is a function then we are in the old style stats so just\n    // pass back the original getStats format to avoid breaking old users.\n\n\n    if (arguments.length > 0 && typeof selector === 'function') {\n      return origGetStats.apply(this, arguments);\n    }\n\n    // When spec-style getStats is supported, return those when called with\n    // either no arguments or the selector argument is null.\n    if (origGetStats.length === 0 && (arguments.length === 0 || typeof selector !== 'function')) {\n      return origGetStats.apply(this, []);\n    }\n\n    var fixChromeStats_ = function fixChromeStats_(response) {\n      var standardReport = {};\n      var reports = response.result();\n      reports.forEach(function (report) {\n        var standardStats = {\n          id: report.id,\n          timestamp: report.timestamp,\n          type: {\n            localcandidate: 'local-candidate',\n            remotecandidate: 'remote-candidate'\n          }[report.type] || report.type\n        };\n        report.names().forEach(function (name) {\n          standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n      });\n\n      return standardReport;\n    };\n\n    // shim getStats with maplike support\n    var makeMapStats = function makeMapStats(stats) {\n      return new Map(Object.keys(stats).map(function (key) {\n        return [key, stats[key]];\n      }));\n    };\n\n    if (arguments.length >= 2) {\n      var successCallbackWrapper_ = function successCallbackWrapper_(response) {\n        onSucc(makeMapStats(fixChromeStats_(response)));\n      };\n\n      return origGetStats.apply(this, [successCallbackWrapper_, selector]);\n    }\n\n    // promise-support\n    return new Promise(function (resolve, reject) {\n      origGetStats.apply(_this5, [function (response) {\n        resolve(makeMapStats(fixChromeStats_(response)));\n      }, reject]);\n    }).then(onSucc, onErr);\n  };\n}\n\nfunction shimSenderReceiverGetStats(window) {\n  if (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        var _this6 = this;\n\n        var senders = origGetSenders.apply(this, []);\n        senders.forEach(function (sender) {\n          return sender._pc = _this6;\n        });\n        return senders;\n      };\n    }\n\n    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        var sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      var sender = this;\n      return this._pc.getStats().then(function (result) {\n        return (\n          /* Note: this will include stats of all senders that\n           *   send a track with the same id as sender.track as\n           *   it is not possible to identify the RTCRtpSender.\n           */\n          utils.filterStats(result, sender.track, true)\n        );\n      });\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    var origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n        var _this7 = this;\n\n        var receivers = origGetReceivers.apply(this, []);\n        receivers.forEach(function (receiver) {\n          return receiver._pc = _this7;\n        });\n        return receivers;\n      };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', function (e) {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      var receiver = this;\n      return this._pc.getStats().then(function (result) {\n        return utils.filterStats(result, receiver.track, false);\n      });\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype && 'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  var origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 && arguments[0] instanceof window.MediaStreamTrack) {\n      var track = arguments[0];\n      var sender = void 0;\n      var receiver = void 0;\n      var err = void 0;\n      this.getSenders().forEach(function (s) {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(function (r) {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || sender && receiver) {\n        return Promise.reject(new DOMException('There are more than one sender or receiver for the track.', 'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException('There is no sender or receiver for the track.', 'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nfunction shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\n    var _this8 = this;\n\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n    return Object.keys(this._shimmedLocalStreams).map(function (streamId) {\n      return _this8._shimmedLocalStreams[streamId][0];\n    });\n  };\n\n  var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\n    if (!stream) {\n      return origAddTrack.apply(this, arguments);\n    }\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    var sender = origAddTrack.apply(this, arguments);\n    if (!this._shimmedLocalStreams[stream.id]) {\n      this._shimmedLocalStreams[stream.id] = [stream, sender];\n    } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n      this._shimmedLocalStreams[stream.id].push(sender);\n    }\n    return sender;\n  };\n\n  var origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    var _this9 = this;\n\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(function (track) {\n      var alreadyExists = _this9.getSenders().find(function (s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.', 'InvalidAccessError');\n      }\n    });\n    var existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    var newSenders = this.getSenders().filter(function (newSender) {\n      return existingSenders.indexOf(newSender) === -1;\n    });\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n    delete this._shimmedLocalStreams[stream.id];\n    return origRemoveStream.apply(this, arguments);\n  };\n\n  var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\n    var _this10 = this;\n\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n    if (sender) {\n      Object.keys(this._shimmedLocalStreams).forEach(function (streamId) {\n        var idx = _this10._shimmedLocalStreams[streamId].indexOf(sender);\n        if (idx !== -1) {\n          _this10._shimmedLocalStreams[streamId].splice(idx, 1);\n        }\n        if (_this10._shimmedLocalStreams[streamId].length === 1) {\n          delete _this10._shimmedLocalStreams[streamId];\n        }\n      });\n    }\n    return origRemoveTrack.apply(this, arguments);\n  };\n}\n\nfunction shimAddTrackRemoveTrack(window, browserDetails) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack && browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  var origGetLocalStreams = window.RTCPeerConnection.prototype.getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\n    var _this11 = this;\n\n    var nativeStreams = origGetLocalStreams.apply(this);\n    this._reverseStreams = this._reverseStreams || {};\n    return nativeStreams.map(function (stream) {\n      return _this11._reverseStreams[stream.id];\n    });\n  };\n\n  var origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    var _this12 = this;\n\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(function (track) {\n      var alreadyExists = _this12.getSenders().find(function (s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.', 'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      var newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    origRemoveStream.apply(this, [this._streams[stream.id] || stream]);\n    delete this._reverseStreams[this._streams[stream.id] ? this._streams[stream.id].id : stream.id];\n    delete this._streams[stream.id];\n  };\n\n  window.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\n    var _this13 = this;\n\n    if (this.signalingState === 'closed') {\n      throw new DOMException('The RTCPeerConnection\\'s signalingState is \\'closed\\'.', 'InvalidStateError');\n    }\n    var streams = [].slice.call(arguments, 1);\n    if (streams.length !== 1 || !streams[0].getTracks().find(function (t) {\n      return t === track;\n    })) {\n      // this is not fully correct but all we can manage without\n      // [[associated MediaStreams]] internal slot.\n      throw new DOMException('The adapter.js addTrack polyfill only supports a single ' + ' stream which is associated with the specified track.', 'NotSupportedError');\n    }\n\n    var alreadyExists = this.getSenders().find(function (s) {\n      return s.track === track;\n    });\n    if (alreadyExists) {\n      throw new DOMException('Track already exists.', 'InvalidAccessError');\n    }\n\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n    var oldStream = this._streams[stream.id];\n    if (oldStream) {\n      // this is using odd Chrome behaviour, use with caution:\n      // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n      // Note: we rely on the high-level addTrack/dtmf shim to\n      // create the sender with a dtmf sender.\n      oldStream.addTrack(track);\n\n      // Trigger ONN async.\n      Promise.resolve().then(function () {\n        _this13.dispatchEvent(new Event('negotiationneeded'));\n      });\n    } else {\n      var newStream = new window.MediaStream([track]);\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      this.addStream(newStream);\n    }\n    return this.getSenders().find(function (s) {\n      return s.track === track;\n    });\n  };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    var sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(function (internalId) {\n      var externalStream = pc._reverseStreams[internalId];\n      var internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'), externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp: sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    var sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(function (internalId) {\n      var externalStream = pc._reverseStreams[internalId];\n      var internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'), internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp: sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function (method) {\n    var nativeMethod = window.RTCPeerConnection.prototype[method];\n    var methodObj = _defineProperty({}, method, function () {\n      var _this14 = this;\n\n      var args = arguments;\n      var isLegacyCall = arguments.length && typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [function (description) {\n          var desc = replaceInternalStreamId(_this14, description);\n          args[0].apply(null, [desc]);\n        }, function (err) {\n          if (args[1]) {\n            args[1].apply(null, err);\n          }\n        }, arguments[2]]);\n      }\n      return nativeMethod.apply(this, arguments).then(function (description) {\n        return replaceInternalStreamId(_this14, description);\n      });\n    });\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n\n  var origSetLocalDescription = window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription = function setLocalDescription() {\n    if (!arguments.length || !arguments[0].type) {\n      return origSetLocalDescription.apply(this, arguments);\n    }\n    arguments[0] = replaceExternalStreamId(this, arguments[0]);\n    return origSetLocalDescription.apply(this, arguments);\n  };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  var origLocalDescription = Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype, 'localDescription', {\n    get: function get() {\n      var description = origLocalDescription.get.apply(this);\n      if (description.type === '') {\n        return description;\n      }\n      return replaceInternalStreamId(this, description);\n    }\n  });\n\n  window.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\n    var _this15 = this;\n\n    if (this.signalingState === 'closed') {\n      throw new DOMException('The RTCPeerConnection\\'s signalingState is \\'closed\\'.', 'InvalidStateError');\n    }\n    // We can not yet check for sender instanceof RTCRtpSender\n    // since we shim RTPSender. So we check if sender._pc is set.\n    if (!sender._pc) {\n      throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' + 'does not implement interface RTCRtpSender.', 'TypeError');\n    }\n    var isLocal = sender._pc === this;\n    if (!isLocal) {\n      throw new DOMException('Sender was not created by this connection.', 'InvalidAccessError');\n    }\n\n    // Search for the native stream the senders track belongs to.\n    this._streams = this._streams || {};\n    var stream = void 0;\n    Object.keys(this._streams).forEach(function (streamid) {\n      var hasTrack = _this15._streams[streamid].getTracks().find(function (track) {\n        return sender.track === track;\n      });\n      if (hasTrack) {\n        stream = _this15._streams[streamid];\n      }\n    });\n\n    if (stream) {\n      if (stream.getTracks().length === 1) {\n        // if this is the last track of the stream, remove the stream. This\n        // takes care of any shimmed _senders.\n        this.removeStream(this._reverseStreams[stream.id]);\n      } else {\n        // relying on the same odd chrome behaviour as above.\n        stream.removeTrack(sender.track);\n      }\n      this.dispatchEvent(new Event('negotiationneeded'));\n    }\n  };\n}\n\nfunction shimPeerConnection(window, browserDetails) {\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach(function (method) {\n      var nativeMethod = window.RTCPeerConnection.prototype[method];\n      var methodObj = _defineProperty({}, method, function () {\n        arguments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);\n        return nativeMethod.apply(this, arguments);\n      });\n      window.RTCPeerConnection.prototype[method] = methodObj[method];\n    });\n  }\n}\n\n// Attempt to fix ONN in plan-b mode.\nfunction fixNegotiationNeeded(window, browserDetails) {\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', function (e) {\n    var pc = e.target;\n    if (browserDetails.version < 72 || pc.getConfiguration && pc.getConfiguration().sdpSemantics === 'plan-b') {\n      if (pc.signalingState !== 'stable') {\n        return;\n      }\n    }\n    return e;\n  });\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}